class widgetMegaMenu extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{targetInstance:".eac-mega-menu",parentElement:".eac-mega-menu",target_nav:".mega-menu_nav-wrapper",target_top_links:".mega-menu_top-link",target_sub_links:".mega-menu_sub-link",target_sub_menus:".mega-menu_sub-menu",target_skip_grid:".eac-skip-grid",button_toggle_open:".mega-menu_flyout-open",button_toggle_close:".mega-menu_flyout-close",button_svg_icon:".icon-menu-toggle svg",cart_quantity:"#menu-item-mini-cart span.badge-cart__quantity",target_nav_menu:"mega-menu_nav-menu",mini_cart:"#menu-item-mini-cart",mini_cart_links:".mini-cart-product a",mini_cart_title:"#menu-item-mini-cart .widgettitle",bodyCheckout:"woocommerce-account",bodyCart:"woocommerce-cart"}}}getDefaultElements(){const e=this.getSettings("selectors");let t={$targetInstance:this.$element.find(e.targetInstance),$parentElement:this.$element.find(e.parentElement).parent(),$target_nav:this.$element.find(e.target_nav),$target_top_links:this.$element.find(e.target_top_links),$target_sub_links:this.$element.find(e.target_sub_links),$target_sub_menus:this.$element.find(e.target_sub_menus),$target_skip_grid:this.$element.find(e.target_skip_grid),$button_toggle_open:this.$element.find(e.button_toggle_open),$button_toggle_close:this.$element.find(e.button_toggle_close),$top_button_svg_icon:this.$element.find(e.target_top_links).find(e.button_svg_icon),$sub_button_svg_icon:this.$element.find(e.target_sub_links).find(e.button_svg_icon),$cart_quantity:this.$element.find(e.cart_quantity),$target_nav_menu:this.$element.find(e.target_nav_menu),$mini_cart:this.$element.find(e.mini_cart),$mini_cart_links:this.$element.find(e.mini_cart_links),$mini_cart_title:this.$element.find(e.mini_cart_title),hasBodyClassCheckout:jQuery("body").hasClass(e.bodyCheckout),hasBodyClassCart:jQuery("body").hasClass(e.bodyCart),breakpoint:this.$element.find(e.target_nav).data("breakpoint"),isSticky:"yes"===this.$element.find(e.target_nav).data("enable-fixed"),mediaQuery:null,isBreakpointEnabled:!1,optionsObserve:{root:null,rootMargin:"-40px 0px 0px 0px",threshold:0},fixedClass:"menu-fixed",isEditMode:elementorFrontend.isEditMode(),isPreviewMode:!1,hasMiniCart:this.$element.find(e.target_nav).data("mini-cart"),hasLastItemReverted:this.$element.find(e.target_nav).data("item-reverted"),hasMenuCache:this.$element.find(e.target_nav).data("menu-cache"),isMenuOrientedVertical:this.$element.hasClass("mega-menu_orientation-vrt"),adminBar:document.getElementById("wpadminbar"),$target_all_links:null};t.mediaQuery=window.matchMedia(t.breakpoint);const n=window.location.search,s=new URLSearchParams(n);return t.isPreviewMode=!!s.has("preview"),t}onInit(){super.onInit(),this.elements.isEditMode||this.elements.isPreviewMode||!this.elements.hasMenuCache||this.setMenuClass(),this.elements.mediaQuery.matches?(this.elements.$target_nav.addClass("breakpoint"),this.elements.isBreakpointEnabled=!0,this.elements.$button_toggle_open.attr("aria-hidden","false"),this.elements.$button_toggle_close.attr("aria-hidden","false"),this.widgetToggleOn()):this.bindMouseEvents(),this.elements.hasMiniCart&&(this.elements.hasBodyClassCart||this.elements.hasBodyClassCheckout)&&this.elements.$mini_cart.remove(),this.elements.$mini_cart_title.attr("aria-hidden","true")}bindEvents(){const e=this.elements,t=this;if(window.setTimeout((()=>{e.$target_all_links=e.$targetInstance.find("a"),t.setSubMenuAriaAttributes(),e.$target_all_links.on("keydown",t.bindKeyboardEvents.bind(t)),e.hasMiniCart&&(jQuery(document.body).on("removed_from_cart",t.onRemovedFromCart.bind(t)),jQuery(document.body).trigger("removed_from_cart"))}),1e3),this.elements.mediaQuery.addEventListener("change",this.onMediaQueryChange.bind(this)),window.IntersectionObserver&&this.elements.isSticky&&!this.elements.isEditMode){new IntersectionObserver(this.observeElementInViewport.bind(this),this.elements.optionsObserve).observe(this.elements.$parentElement[0])}}setSubMenuAriaAttributes(){jQuery.each(jQuery('ul[role="menu"]',this.elements.$targetInstance),((e,t)=>{let n=jQuery(t).parent("li").find("> a .nav-menu_item-title");const s=jQuery(t).parent("li").attr("id");1===n.length?(jQuery(t).attr("aria-label",n.text()),s&&jQuery(t).attr("id","sub-menu-"+s.split("-")[2])):(n=jQuery(t).parent("li").find("> a .mega-menu_item-title"),1===n.length&&(jQuery(t).attr("aria-label",n.text()),s&&jQuery(t).attr("id","sub-menu-"+s.split("-")[2])))})),this.elements.hasMiniCart&&(jQuery.each(jQuery(".mini-cart-product.mega-menu_sub-menu li.woocommerce-mini-cart-item.mini_cart_item",this.elements.$targetInstance),((e,t)=>{jQuery(t).attr("role","none")})),jQuery.each(jQuery(".mini-cart-product.mega-menu_sub-menu a:not(.remove_from_cart_button):not(.button)",this.elements.$targetInstance),((e,t)=>{const n=jQuery(t).text();jQuery(t).attr("role","menuitem"),jQuery(t).attr("aria-label","View single product page: "+jQuery.trim(n))})),jQuery(".mini-cart-product.mega-menu_sub-menu ul.woocommerce-mini-cart.cart_list.product_list_widget",this.elements.$targetInstance).attr("role","menu"),jQuery(".mini-cart-product.mega-menu_sub-menu .widget_shopping_cart_content",this.elements.$targetInstance).attr("role","menuitem"),jQuery(".mini-cart-product.mega-menu_sub-menu .widget.woocommerce.widget_shopping_cart",this.elements.$targetInstance).attr("role","menuitem"))}bindKeyboardEvents(e){const t=e.code||e.key||0,n=document.activeElement,s=jQuery(n).hasClass("mega-menu_top-link"),i=jQuery(n).parents("li.mega-menu_top-item").find("a.mega-menu_top-link"),a=this.elements.$target_top_links.index(i)===this.elements.$target_top_links.length-1&&this.elements.hasLastItemReverted,r=jQuery(n).parent("li").hasClass("mega-menu_top-item"),l=jQuery(n).hasClass("mega-menu_sub-link"),o=jQuery(n).parent("li").hasClass("mega-menu_sub-item"),u=jQuery(n).parent("li").parent("ul.mega-menu_sub-menu"),m=jQuery(n).parents("div").hasClass("widget_shopping_cart_content"),g=jQuery(n).parents("div.widget_shopping_cart_content");if("Tab"!==t||e.shiftKey)if("Tab"===t&&e.shiftKey&&!jQuery(n).hasClass("mega-menu_top-link"))e.preventDefault();else if("ArrowDown"===t){let t,s,i;e.preventDefault(),r&&!this.elements.isMenuOrientedVertical?(t=jQuery(n).parent("li").find("> ul > li a"),jQuery(t.get(0)).trigger("focus")):o||m?(t=o?this.elements.isBreakpointEnabled&&"grid"===jQuery(n).next("ul").css("display")?jQuery(n).parent("li").find("> ul > li > a"):u.find("> li > a"):g.find("a"),s=t.index(jQuery(n)),i=s===t.length-1?t.get(0):s+1<t.length?t.get(s+1):t.get(s),jQuery(i).trigger("focus")):this.elements.isMenuOrientedVertical||(t=jQuery(n).parents("li.menu-item-has-children").last().find("> ul > li > a"),s=t.index(jQuery(n)),i=s+1<t.length?t.get(s+1):t.get(s),jQuery(i).trigger("focus"))}else if("ArrowUp"===t){let t,s,a;const r=jQuery(n).parent("li").parent("ul").parent("li").hasClass("mega-menu_top-item");e.preventDefault(),(o||m)&&(t=o?u.find("> li > a"):g.find("a"),s=t.index(jQuery(n)),a=r&&0===s&&!this.elements.isMenuOrientedVertical?i:s-1>=0?t.get(s-1):t.get(s),jQuery(a).trigger("focus"))}else if("ArrowRight"===t&&!a||"ArrowLeft"===t&&a&&!this.elements.isBreakpointEnabled){if(e.preventDefault(),l){const e=jQuery(n).parent("li").find("> ul > li > a");jQuery(e.get(0)).trigger("focus")}else if(s&&this.elements.isMenuOrientedVertical){const e=jQuery(n).siblings("ul").first().find("> li > a");jQuery(e.get(0)).trigger("focus")}}else if("ArrowLeft"===t&&!a||"ArrowRight"===t&&a&&!this.elements.isBreakpointEnabled){if(e.preventDefault(),l){const e=jQuery(n).parent("li").parent("ul").parent("li").hasClass("mega-menu_top-item"),t=jQuery(n).parent("li").parent("ul").find("a").index(jQuery(n)),s=jQuery(n).parent("li").parent("ul").parent("li").find("a").first();0!==t||e?0===t&&e&&this.elements.isMenuOrientedVertical&&i.trigger("focus"):s.trigger("focus")}}else if("Escape"===t)if(s)this.elements.$target_skip_grid.trigger("focus");else{const e=this.elements.$target_top_links.index(i);jQuery(this.elements.$target_top_links.get(e)).trigger("focus")}else"Home"===t?(e.preventDefault(),jQuery(this.elements.$target_top_links.get(0)).trigger("focus")):"End"===t&&(e.preventDefault(),jQuery(this.elements.$target_top_links.get(this.elements.$target_top_links.length-1)).trigger("focus"));else if(s){const t=this.elements.$target_top_links.index(jQuery(n));if(t+1<this.elements.$target_top_links.length){const n=jQuery(this.elements.$target_top_links.get(t+1));e.preventDefault(),n.trigger("focus")}else this.elements.$target_skip_grid.trigger("focus")}}onMediaQueryChange(){window.matchMedia(this.elements.breakpoint).matches?(this.elements.$target_nav.addClass("breakpoint"),this.elements.isBreakpointEnabled=!0,this.elements.$button_toggle_open.attr("aria-hidden","false"),this.elements.$button_toggle_close.attr("aria-hidden","false"),this.widgetToggleOn()):(this.elements.$target_nav.removeClass("breakpoint"),this.elements.isBreakpointEnabled=!1,this.elements.$button_toggle_open.attr("aria-hidden","true"),this.elements.$button_toggle_close.attr("aria-hidden","true"),this.widgetToggleOff()),this.elements.$top_button_svg_icon.css("transform","rotate(0deg)"),this.elements.$sub_button_svg_icon.css("transform","rotate(0deg)")}widgetToggleOn(){this.bindButtonsToggleEvents(),this.unbindMouseEvents(),this.elements.$button_toggle_open.css("display","block"),this.elements.$button_toggle_close.css("display","none"),this.elements.$targetInstance.find("[aria-expanded]").attr("aria-expanded","false"),this.elements.$target_nav.css("display","none"),this.elements.$target_top_links.nextAll(".mega-menu_sub-menu").css("display","none"),this.elements.$target_sub_links.nextAll(".mega-menu_sub-menu").css("display","none")}widgetToggleOff(){this.unbindButtonsToggleEvents(),this.bindMouseEvents(),this.elements.$button_toggle_open.add(this.elements.$button_toggle_close).css("display","none"),this.elements.$targetInstance.find("[aria-expanded]").attr("aria-expanded","false"),this.elements.$target_nav.css("display","block"),this.elements.$target_sub_menus.css("display","none")}bindButtonsToggleEvents(){this.elements.$button_toggle_open.on("click",this.onButtonToggleOpen.bind(this)),this.elements.$button_toggle_close.on("click",this.onButtonToggleClose.bind(this)),this.elements.$target_top_links.on("click",this.onTargetTopLink.bind(this)),this.elements.$target_sub_links.on("click",this.onTargetSubLink.bind(this))}unbindButtonsToggleEvents(){this.elements.$button_toggle_open.off("click"),this.elements.$button_toggle_close.off("click"),this.elements.$target_top_links.off("click"),this.elements.$target_sub_links.off("click")}bindMouseEvents(){jQuery('li:has(ul[role="menu"])',this.elements.$targetInstance).on("focusin mouseenter",(e=>{jQuery(e.currentTarget).children('a[aria-haspopup="true"]').first().attr("aria-expanded","true")})),jQuery('li:has(ul[role="menu"])',this.elements.$targetInstance).on("focusout mouseleave",(e=>{jQuery(e.currentTarget).children('a[aria-haspopup="true"]').first().attr("aria-expanded","false")}))}unbindMouseEvents(){jQuery('li:has(ul[role="menu"])',this.elements.$targetInstance).off("focusin mouseenter"),jQuery('li:has(ul[role="menu"])',this.elements.$targetInstance).off("focusout mouseleave")}observeElementInViewport(e,t){e[0].target;e[0].intersectionRatio>0?(this.elements.$targetInstance[0].classList.remove(this.elements.fixedClass),this.elements.$targetInstance[0].style.top=""):(this.elements.$targetInstance[0].classList.add(this.elements.fixedClass),this.elements.adminBar&&(this.elements.$targetInstance[0].style.top=this.elements.adminBar.clientHeight+"px"))}onRemovedFromCart(){const e=this.elements;jQuery.ajax({url:eacUpdateCounter.ajax_url,type:"post",data:{action:eacUpdateCounter.ajax_action,nonce:eacUpdateCounter.ajax_nonce}}).done((t=>{!0===t.success&&e.$cart_quantity.text(t.data)}))}onButtonToggleOpen(e){e.stopImmediatePropagation(),this.elements.$button_toggle_open.css("display","none").attr("aria-expanded","true"),this.elements.$button_toggle_close.css("display","block").attr("aria-expanded","true"),this.elements.$target_nav.toggle(),this.elements.$button_toggle_close.focus()}onButtonToggleClose(e){e.stopImmediatePropagation(),this.elements.$button_toggle_close.css("display","none").attr("aria-expanded","false"),this.elements.$button_toggle_open.css("display","block").attr("aria-expanded","false"),this.elements.$target_nav.toggle(),this.elements.$button_toggle_open.focus(),this.elements.$top_button_svg_icon.css("transform","rotate(0deg)"),this.elements.$sub_button_svg_icon.css("transform","rotate(0deg)"),this.elements.$target_top_links.nextAll(".mega-menu_sub-menu").css("display","none"),this.elements.$target_sub_links.nextAll(".mega-menu_sub-menu").css("display","none")}onTargetTopLink(e){const t=jQuery(e.currentTarget),n=t.find(".icon-menu-toggle svg");if(!t.attr("aria-haspopup"))return;e.stopImmediatePropagation();const s="true"===t.attr("aria-expanded")?"false":"true";jQuery.each(this.elements.$target_top_links,((e,t)=>{jQuery(t).attr("aria-haspopup")&&jQuery(t).attr("aria-expanded","false")})),t.attr("aria-expanded",s),this.elements.$target_sub_menus.not(t.next(".mega-menu_sub-menu")).css("display","none").slideUp(),jQuery.each(this.elements.$target_sub_links.not(t.next(".mega-menu_sub-link")),((e,t)=>{jQuery(t).attr("aria-haspopup")&&jQuery(t).attr("aria-expanded","false")})),this.elements.$sub_button_svg_icon.css("transform","rotate(0deg)"),0!==n.length?(this.elements.$top_button_svg_icon.not(n).css("transform","rotate(0deg)"),n.css("transform","rotate("+this.setRotateIconSvg(n[0])+")")):this.elements.$top_button_svg_icon.css("transform","rotate(0deg)"),t.next(".mega-menu_sub-menu").slideToggle()}onTargetSubLink(e){const t=jQuery(e.currentTarget),n=t.parent("li").find(".icon-menu-toggle svg").first();if(!t.attr("aria-haspopup"))return;e.stopImmediatePropagation();const s="true"===t.attr("aria-expanded")?"false":"true";jQuery.each(t.nextAll(".mega-menu_sub-menu"),((e,t)=>{jQuery(t).attr("aria-haspopup")&&jQuery(t).attr("aria-expanded","false")})),t.attr("aria-expanded",s),n.css("transform","rotate("+this.setRotateIconSvg(n[0])+")"),t.nextAll(".mega-menu_sub-menu").slideToggle()}setRotateIconSvg(e){let t=window.getComputedStyle(e,null).getPropertyValue("transform").split("(")[1];t=t.split(")")[0],t=t.split(",");const n=t[0],s=t[1];Math.sqrt(n*n+s*s);return 0===Math.round(Math.atan2(s,n)*(180/Math.PI))?"-180deg":"0deg"}setMenuClass(){this.elements.$targetInstance.find(".current-menu-ancestor, .current-menu-parent, .current_page_item, .current-menu-item").removeClass("current-menu-ancestor current-menu-parent current_page_item current-menu-item"),this.elements.$targetInstance.find('a[aria-current="page"]').removeAttr("aria-current");const e=window.location.href.split(/\?|\#/g)[0];this.elements.$target_nav.find("li a").each((()=>{if(e===jQuery(this).attr("href")){const e=jQuery(this).parents().closest("li").not("li#menu-item-mini-cart");jQuery(this).attr("aria-current","page"),e.length&&(jQuery.fn.reverse=[].reverse,e.reverse().each((e=>{0===e?jQuery(this).addClass("current-menu-item"):1===e?jQuery(this).addClass("current-menu-parent"):jQuery(this).addClass("current-menu-ancestor")})))}}))}}window.addEventListener("DOMContentLoaded",(()=>{window.addEventListener("elementor/frontend/init",(()=>{elementorFrontend.elementsHandler.attachHandler("eac-addon-mega-menu",widgetMegaMenu)}))}));