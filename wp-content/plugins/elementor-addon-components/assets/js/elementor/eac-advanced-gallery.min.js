import EacSwiper from"../modules/eac-swiper.js";class widgetAdvancedGallery extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{targetInstance:".eac-advanced-gallery",target:".advanced-gallery",targetSkipGrid:".eac-skip-grid",imagesInstance:".advanced-gallery__image-instance",itemsInstance:".advanced-gallery__item",targetSizer:".advanced-gallery__item-sizer",targetJustify:".fj-gallery",filterWrapperLink:".ag-filters__wrapper a",filterWrapperSelect:".ag-filters__select"}}}getDefaultElements(){const e=this.getSettings("selectors");let t={$targetInstance:this.$element.find(e.targetInstance),$target:this.$element.find(e.target),$targetSkipGrid:this.$element.find(e.targetSkipGrid),$imagesInstance:this.$element.find(e.imagesInstance),$itemsInstance:this.$element.find(e.itemsInstance),$targetSizer:this.$element.find(e.targetSizer),$targetJustify:this.$element.find(e.targetJustify),filterWrapper:".ag-filters__wrapper",$filterWrapperLink:this.$element.find(e.filterWrapperLink),filterItem:".ag-filters__item",filterActive:"ag-active",$filterWrapperSelect:this.$element.find(e.filterWrapperSelect),settings:this.$element.find(e.target).data("settings")||{},$targetId:null,isotopeOptions:{itemSelector:".advanced-gallery__item",percentPosition:!0,masonry:{columnWidth:".advanced-gallery__item-sizer"},fitRows:{equalheight:!1},layoutMode:"fitRows",sortBy:"original-order",stagger:30,originLeft:!0},justifyOptions:{itemSelector:".fj-gallery-item",rowHeight:250,rowHeightTolerance:0,edgeCaseMinRowHeight:1,gutter:10,calculateItemsHeight:!0},has_swiper:!1};return t.$targetId=jQuery("#"+t.settings.data_id),t.isotopeOptions.layoutMode=t.settings.data_layout,t.isotopeOptions.fitRows.equalheight=t.settings.data_equalheight,t.isotopeOptions.sortBy=!0===t.settings.data_order?"random":"original-order",t.isotopeOptions.originLeft=t.settings.data_rtl,t.justifyOptions.gutter=t.settings.data_gutter,t.justifyOptions.rowHeight=t.settings.data_rowheight,t.has_swiper=t.settings.data_sw_swiper||!1,t}onInit(){super.onInit(),this.elements.has_swiper?this.setSwiperGallery():"justify"===this.elements.settings.data_layout?window.setTimeout(this.setLayoutModeJustify.bind(this),100):window.setTimeout(this.setLayoutModeGrid.bind(this),100)}bindEvents(){this.elements.$itemsInstance.length>0&&this.elements.$targetInstance.on("keydown",this.setKeyboardEvents.bind(this)),!this.elements.has_swiper&&this.elements.settings.data_filtre&&(this.elements.$filterWrapperLink.on("click",this.onFilterGridClick.bind(this)),this.elements.$filterWrapperSelect.on("change",this.onFilterGridChange.bind(this))),jQuery(".e-n-tab-title").on("click",(()=>{setTimeout((()=>{window.dispatchEvent(new Event("resize"))}),50)}))}onFilterGridClick(e){const t=jQuery(e.currentTarget),i=t.parents(this.elements.filterWrapper);return t.parents(this.elements.filterItem).hasClass(this.elements.filterActive)||(i.find("."+this.elements.filterActive).removeClass(this.elements.filterActive),t.parents(this.elements.filterItem).addClass(this.elements.filterActive),this.elements.$targetId.isotope({filter:t.attr("data-filter")})),!1}onFilterGridChange(e){return this.elements.$targetId.isotope({filter:e.currentTarget.value}),!1}onElementChange(e){if("ag_image_height"===e&&"justify"===this.elements.settings.data_layout){let t=this.elements.justifyOptions.rowHeight;"ag_image_height"===e?t=this.getElementSettings("ag_image_height").size:"ag_image_height_tablet_extra"===e?t=this.getElementSettings("ag_image_height_tablet_extra").size:"ag_image_height_tablet"===e?t=this.getElementSettings("ag_image_height_tablet").size:"ag_image_height_mobile_extra"===e?t=this.getElementSettings("ag_image_height_mobile_extra").size:"ag_image_height_mobile"===e?t=this.getElementSettings("ag_image_height_mobile").size:"ag_image_height_laptop"===e&&(t=this.getElementSettings("ag_image_height_laptop").size),this.elements.justifyOptions.rowHeight=t,this.setLayoutModeJustify()}}setLayoutModeJustify(){this.elements.$targetSizer.remove(),this.elements.$targetId.imagesLoaded().done((()=>{this.elements.$targetJustify.fjGallery(this.elements.justifyOptions)}))}setLayoutModeGrid(){this.elements.settings.data_metro?this.elements.$itemsInstance.addClass("mode-metro"):this.elements.$itemsInstance.removeClass("mode-metro"),this.elements.$targetId.isotope(this.elements.isotopeOptions),this.elements.$targetId.imagesLoaded().done((()=>{this.elements.$targetId.isotope(this.elements.isotopeOptions)}))}setSwiperGallery(){new EacSwiper(this.elements.settings,this.elements.$targetInstance)}setKeyboardEvents(e){const t='button, a, [tabindex]:not([tabindex="-1"])',i=e.code||e.key||0;let s=null,n=null,a=null,r=null;if(this.elements.settings.data_filtre){const e=this.elements.$targetId.isotope("getFilteredItemElements");s=jQuery(e[0]).hasClass("advanced-gallery__item-sizer")?jQuery(e[1]):jQuery(e[0]),n=jQuery(e[e.length-1])}else s=this.elements.$itemsInstance.first(),n=this.elements.$itemsInstance.last();a=s.find(".advanced-gallery__content"),r=n.find(".advanced-gallery__content"),"Home"===i?(e.preventDefault(),"overlay-out"===this.elements.settings.data_overlay?s.find(t).first().trigger("focus"):(a.trigger("focus"),window.setTimeout((()=>{a.find(t).first().focus()}),500))):"End"===i?(e.preventDefault(),"overlay-out"===this.elements.settings.data_overlay?n.find(t).last().trigger("focus"):(r.trigger("focus"),window.setTimeout((()=>{r.find(t).last().focus()}),500))):"Escape"===i&&this.elements.$targetSkipGrid.trigger("focus")}}jQuery(window).on("elementor/frontend/init",(()=>{elementorFrontend.hooks.addAction("frontend/element_ready/eac-addon-advanced-gallery.default",(e=>{elementorFrontend.elementsHandler.addHandler(widgetAdvancedGallery,{$element:e})}))}));