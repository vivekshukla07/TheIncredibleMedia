import EacSwiper from"../modules/eac-swiper.js";class widgetImageGalerie extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{targetInstance:".eac-image-galerie",target:".image-galerie",targetSkipGrid:".eac-skip-grid",imagesInstance:".image-galerie__image-instance",itemsInstance:".image-galerie__item",targetSizer:".image-galerie__item-sizer",targetJustify:".fj-gallery",filterWrapperLink:".ig-filters__wrapper a",filterWrapperSelect:".ig-filters__select"}}}getDefaultElements(){const e=this.getSettings("selectors");let t={$targetInstance:this.$element.find(e.targetInstance),$target:this.$element.find(e.target),$targetSkipGrid:this.$element.find(e.targetSkipGrid),$imagesInstance:this.$element.find(e.imagesInstance),$itemsInstance:this.$element.find(e.itemsInstance),$targetSizer:this.$element.find(e.targetSizer),$targetJustify:this.$element.find(e.targetJustify),$filterWrapperLink:this.$element.find(e.filterWrapperLink),$filterWrapperSelect:this.$element.find(e.filterWrapperSelect),settings:this.$element.find(e.target).data("settings"),$targetId:null,isotopeOptions:{itemSelector:".image-galerie__item",percentPosition:!0,masonry:{columnWidth:".image-galerie__item-sizer"},fitRows:{equalheight:!1},layoutMode:"fitRows",sortBy:"original-order",visibleStyle:{transform:"scale(1)",opacity:1}},justifyOptions:{itemSelector:".fj-gallery-item",rowHeight:250,rowHeightTolerance:0,edgeCaseMinRowHeight:1,gutter:10,calculateItemsHeight:!0},has_swiper:!1,activeBreakpoints:elementorFrontend.config.responsive.activeBreakpoints,windowWidthMob:0,windowWidthMobExtra:0,windowWidthTab:0,windowWidthTabExtra:0,windowWidthLaptop:0,windowWidthWidescreen:0};return t.$targetId=jQuery("#"+t.settings.data_id),t.isotopeOptions.layoutMode=t.settings.data_layout,t.isotopeOptions.fitRows.equalheight=t.settings.data_equalheight,t.has_swiper=t.settings.data_sw_swiper||!1,t.justifyOptions.gutter=t.settings.data_gutter,t.justifyOptions.rowHeight=t.settings.data_rowheight,t}onInit(){super.onInit(),this.elements.has_swiper?this.setSwiperGallery():"justify"===this.elements.settings.data_layout?window.setTimeout(this.setLayoutModeJustify.bind(this),100):window.setTimeout(this.setLayoutModeGrid.bind(this),100)}bindEvents(){this.elements.$itemsInstance.length>0&&this.elements.$targetInstance.on("keydown",this.setKeyboardEvents.bind(this)),!this.elements.has_swiper&&this.elements.settings.data_filtre&&(this.elements.$filterWrapperLink.on("click",this.onFilterGridClick.bind(this)),this.elements.$filterWrapperSelect.on("change",this.onFilterGridChange.bind(this)))}onFilterGridClick(e){const t=jQuery(e.currentTarget),i=t.parents(".ig-filters__wrapper");return t.parents(".ig-filters__item").hasClass("ig-active")||(i.find(".ig-active").removeClass("ig-active"),t.parents(".ig-filters__item").addClass("ig-active"),this.elements.$targetId.isotope({filter:t.attr("data-filter")})),!1}onFilterGridChange(e){return this.elements.$targetId.isotope({filter:e.currentTarget.value}),!1}onElementChange(e){if("ig_image_height"===e&&"justify"===this.elements.settings.data_layout){let t=this.elements.justifyOptions.rowHeight;"ag_image_height"===e?t=this.getElementSettings("ag_image_height").size:"ag_image_height_tablet_extra"===e?t=this.getElementSettings("ag_image_height_tablet_extra").size:"ag_image_height_tablet"===e?t=this.getElementSettings("ag_image_height_tablet").size:"ag_image_height_mobile_extra"===e?t=this.getElementSettings("ag_image_height_mobile_extra").size:"ag_image_height_mobile"===e?t=this.getElementSettings("ag_image_height_mobile").size:"ag_image_height_laptop"===e&&(t=this.getElementSettings("ag_image_height_laptop").size),this.elements.justifyOptions.rowHeight=t,this.setLayoutModeJustify()}}setLayoutModeGrid(){this.elements.settings.data_metro&&this.elements.$itemsInstance.eq(0).addClass("layout-type-metro"),this.elements.$targetId.isotope(this.elements.isotopeOptions),this.elements.$targetId.imagesLoaded().progress((()=>{this.elements.$targetId.isotope(this.elements.isotopeOptions)}))}setLayoutModeJustify(){this.elements.$targetSizer.remove(),this.elements.$targetId.imagesLoaded().done((()=>{this.elements.$targetJustify.fjGallery(this.elements.justifyOptions)}))}setSwiperGallery(){new EacSwiper(this.elements.settings,this.elements.$targetInstance)}setKeyboardEvents(e){const t='button, a, [tabindex]:not([tabindex="-1"])',i=e.code||e.key||0;let s=null,a=null,n=null,r=null;if(this.elements.settings.data_filtre){const e=this.elements.$targetId.isotope("getFilteredItemElements");s=jQuery(e[0]).hasClass("image-galerie__item-sizer")?jQuery(e[1]):jQuery(e[0]),a=jQuery(e[e.length-1])}else s=this.elements.$itemsInstance.first(),a=this.elements.$itemsInstance.last();n=s.find(".image-galerie__content"),r=a.find(".image-galerie__content"),"Home"===i?(e.preventDefault(),"overlay-out"===this.elements.settings.data_overlay?s.find(t).first().trigger("focus"):(n.trigger("focus"),window.setTimeout((()=>{n.find(t).first().focus()}),500))):"End"===i?(e.preventDefault(),"overlay-out"===this.elements.settings.data_overlay?a.find(t).last().trigger("focus"):(r.trigger("focus"),window.setTimeout((()=>{r.find(t).last().focus()}),500))):"Escape"===i&&this.elements.$targetSkipGrid.trigger("focus")}}jQuery(window).on("elementor/frontend/init",(()=>{elementorFrontend.hooks.addAction("frontend/element_ready/eac-addon-image-galerie.default",(e=>{elementorFrontend.elementsHandler.addHandler(widgetImageGalerie,{$element:e})}))}));