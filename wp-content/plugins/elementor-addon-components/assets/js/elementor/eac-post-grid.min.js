import EacSwiper from"../modules/eac-swiper.js";class widgetArticlesListe extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{targetInstance:".eac-articles-liste",targetWrapper:".al-posts__wrapper",targetSkipGrid:".eac-skip-grid",filterWrapper:".al-filters__wrapper a",filterWrapperSelect:".al-filters__select",buttonPaged:".al-more-button-paged"}}}getDefaultElements(){const e=this.getSettings("selectors");let t={$targetInstance:this.$element.find(e.targetInstance),$targetWrapper:this.$element.find(e.targetWrapper),$targetSkipGrid:this.$element.find(e.targetSkipGrid),$filterWrapper:this.$element.find(e.filterWrapper),$filterWrapperSelect:this.$element.find(e.filterWrapperSelect),$buttonPaged:this.$element.find(e.buttonPaged),settings:this.$element.find(e.targetWrapper).data("settings")||{},$targetId:null,$paginationId:null,isotopeOptions:{itemSelector:".al-post__wrapper",percentPosition:!0,masonry:{columnWidth:".al-posts__wrapper-sizer"},fitRows:{equalheight:!1},layoutMode:"fitRows",sortBy:"original-order",visibleStyle:{transform:"scale(1)",opacity:1}},infiniteScrollOptions:{path:function(){return location.pathname.replace(/\/?$/,"/")+"page/"+parseInt(this.pageIndex+1)},debug:!1,button:"",status:"",scrollThreshold:!1,history:!1,horizontalOrder:!1},has_swiper:!1};return t.$targetId=jQuery("#"+t.settings.data_id),t.isotopeOptions.layoutMode=t.settings.data_layout,t.$paginationId=jQuery("#"+t.settings.data_pagination_id),t.infiniteScrollOptions.button="#"+t.settings.data_pagination_id+" button",t.infiniteScrollOptions.status="#"+t.settings.data_pagination_id+" .al-page-load-status",t.isotopeOptions.fitRows.equalheight=t.settings.data_equalheight,t.has_swiper=t.settings.data_sw_swiper||!1,t}onInit(){super.onInit(),this.elements.has_swiper?new EacSwiper(this.elements.settings,this.elements.$targetInstance):(window.setTimeout(this.setLayoutModeGrid.bind(this),100),this.elements.settings.data_filtre&&window.setTimeout(this.setFilterWithWindowLocation.bind(this),500),this.elements.settings.data_pagination&&this.elements.$targetId.infiniteScroll(this.elements.infiniteScrollOptions))}bindEvents(){this.elements.settings.data_filtre&&(this.elements.$filterWrapper.on("click",this.onFilterGridClick.bind(this)),this.elements.$filterWrapperSelect.on("change",this.onFilterGridChange.bind(this))),this.elements.settings.data_pagination&&this.elements.$targetId.on("load.infiniteScroll",this.onLoadInfiniteScroll.bind(this)),this.elements.$targetInstance.length>0&&this.elements.$targetInstance.on("keydown",this.setKeyboardEvents.bind(this))}setLayoutModeGrid(){this.elements.$targetId.isotope(this.elements.isotopeOptions),this.elements.$targetId.imagesLoaded().progress((()=>{this.elements.$targetId.isotope(this.elements.isotopeOptions)}))}setFilterWithWindowLocation(){const e=this,t=window.location.search,i=new URLSearchParams(t),s=!!i.has("filter")&&decodeURIComponent(i.get("filter"));let n=0;if(s){let t=window.setInterval((function(){if(n<5){var i=jQuery(".al-filters__wrapper a[data-filter='."+s+"']",e.elements.$targetInstance),a=jQuery(".al-filters__wrapper-select .al-filters__select",e.elements.$targetInstance);1===i.length&&1===a.length?(window.clearInterval(t),t=null,i.trigger("click"),i.trigger("focus"),a.val("."+s),a.trigger("change")):n++}else window.clearInterval(t),t=null}),100)}}onFilterGridClick(e){const t=jQuery(e.currentTarget);if(t.parents(".al-filters__item").hasClass("al-active"))return!1;t.parents(".al-filters__wrapper").find(".al-active").removeClass("al-active"),t.parents(".al-filters__item").addClass("al-active");const i=t.attr("data-filter");return this.elements.$targetId.isotope({filter:i}),!1}onFilterGridChange(e){const t=e.currentTarget.value;return this.elements.$targetId.isotope({filter:t}),!1}onLoadInfiniteScroll(e,t,i){const s=this.elements.$targetId.data("infiniteScroll"),n="."+this.elements.settings.data_article+".al-post__wrapper",a=jQuery(t).find(n),r=a.find('button, a, [tabindex]:not([tabindex="-1"])').first();if(this.elements.$targetId.append(a).isotope("appended",a),this.elements.$targetId.imagesLoaded().done((()=>{this.elements.$targetId.isotope("layout"),window.setTimeout((()=>{r.trigger("focus")}),200)})),parseInt(s.pageIndex)>=parseInt(this.elements.settings.data_max_pages))this.elements.$targetId.infiniteScroll("destroy"),this.elements.$paginationId.remove();else{const e=parseInt(this.elements.$buttonPaged.text().split("/")[0])+a.length+"/"+this.elements.settings.data_found_posts;this.elements.$buttonPaged.text(e)}}setKeyboardEvents(e){const t='button, a, [tabindex]:not([tabindex="-1"])',i=e.code||e.key||0;let s=null,n=null;if(this.elements.settings.data_filtre){const e=this.elements.$targetId.isotope("getFilteredItemElements");s=jQuery(e[0]).hasClass("al-posts__wrapper-sizer")?jQuery(e[1]):jQuery(e[0]),n=jQuery(e[e.length-1])}else s=this.elements.$targetInstance.find("article").first(),n=this.elements.$targetInstance.find("article").last();"Home"===i?(e.preventDefault(),s.find(t).first().trigger("focus")):"End"===i?(e.preventDefault(),n.find(t).last().trigger("focus")):"Escape"===i&&this.elements.$targetSkipGrid.trigger("focus")}}jQuery(window).on("elementor/frontend/init",(()=>{elementorFrontend.elementsHandler.attachHandler("eac-addon-articles-liste",widgetArticlesListe),elementorFrontend.elementsHandler.attachHandler("eac-addon-product-grid",widgetArticlesListe)}));